# ============================================================================
# Kubernetes Cloud-Native Infrastructure - Terraform
# ============================================================================

## ä¸‰çº§æ¶æ„ç›®å½•ç»“æ„

```
/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ devops/
â”‚   â”‚   â”œâ”€â”€ argocd/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â”‚   â””â”€â”€ versions.tf
â”‚   â”‚   â”œâ”€â”€ flux/
â”‚   â”‚   â”œâ”€â”€ gitlab/
â”‚   â”‚   â”œâ”€â”€ harbor/
â”‚   â”‚   â”œâ”€â”€ helm/
â”‚   â”‚   â”œâ”€â”€ jenkins-x/
â”‚   â”‚   â”œâ”€â”€ kustomize/
â”‚   â”‚   â”œâ”€â”€ spinnaker/
â”‚   â”‚   â””â”€â”€ tekton/
â”‚   â”œâ”€â”€ service-mesh/
â”‚   â”‚   â”œâ”€â”€ istio/
â”‚   â”‚   â”œâ”€â”€ linkerd/
â”‚   â”‚   â””â”€â”€ traefik/
â”‚   â”œâ”€â”€ networking/
â”‚   â”‚   â”œâ”€â”€ calico/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â”‚   â””â”€â”€ versions.tf
â”‚   â”‚   â”œâ”€â”€ coredns/
â”‚   â”‚   â””â”€â”€ metallb/
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ longhorn/
â”‚   â”‚   â”œâ”€â”€ minio/
â”‚   â”‚   â”œâ”€â”€ rook-ceph/
â”‚   â”‚   â””â”€â”€ local-storage/
â”‚   â”œâ”€â”€ monitoring/
â”‚   â”‚   â”œâ”€â”€ prometheus/
â”‚   â”‚   â”‚   â””â”€â”€ dashboards/
â”‚   â”‚   â””â”€â”€ metrics-server/
â”‚   â”œâ”€â”€ observability/
â”‚   â”‚   â”œâ”€â”€ jaeger/
â”‚   â”‚   â”œâ”€â”€ loki/
â”‚   â”‚   â””â”€â”€ fluentd/
â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”œâ”€â”€ aqua-security/
â”‚   â”‚   â”œâ”€â”€ falco/
â”‚   â”‚   â”œâ”€â”€ gatekeeper/
â”‚   â”‚   â”œâ”€â”€ kube-bench/
â”‚   â”‚   â”œâ”€â”€ kube-hunter/
â”‚   â”‚   â”œâ”€â”€ kyverno/
â”‚   â”‚   â”œâ”€â”€ neuvector/
â”‚   â”‚   â”œâ”€â”€ opa/
â”‚   â”‚   â”œâ”€â”€ trivy/
â”‚   â”‚   â””â”€â”€ wazuh/
â”‚   â”œâ”€â”€ ml/
â”‚   â”‚   â”œâ”€â”€ kubeflow/
â”‚   â”‚   â””â”€â”€ mlflow/
â”‚   â”œâ”€â”€ cluster-mgmt/
â”‚   â”‚   â”œâ”€â”€ kubeoperator/
â”‚   â”‚   â””â”€â”€ rancher/
â”‚   â””â”€â”€ platform/
â”‚       â”œâ”€â”€ oam/
â”‚       â””â”€â”€ portainer/
â”‚   â”œâ”€â”€ iam/
â”‚       â””â”€â”€ keycloak/
â”‚   â”œâ”€â”€ certificate/
â”‚       â””â”€â”€ cert-manager/
â”‚   â”œâ”€â”€ backup/
â”‚       â””â”€â”€ velero/
â”‚   â”œâ”€â”€ messaging/
â”‚       â””â”€â”€ rabbitmq/
â”‚   â”œâ”€â”€ database/
â”‚       â””â”€â”€ postgresql/
â”‚   â”œâ”€â”€ cache/
â”‚       â””â”€â”€ redis/
â”‚   â”œâ”€â”€ api-gateway/
â”‚       â””â”€â”€ kong/
â”‚   â”œâ”€â”€ search/
â”‚       â””â”€â”€ elasticsearch/
â”‚   â”œâ”€â”€ cost-management/
â”‚       â””â”€â”€ kubecost/
â”‚   â””â”€â”€ developer-experience/
â”‚       â””â”€â”€ devspace/
â”œâ”€â”€ environments/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â”‚   â””â”€â”€ variables.tf
â”‚   â”œâ”€â”€ prod/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ outputs.tf
â”‚   â”‚   â”œâ”€â”€ providers.tf
â”‚   â”‚   â”œâ”€â”€ terraform.tfvars
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ versions.tf
â”‚   â””â”€â”€ stage/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ terraform.tfvars
â”‚       â””â”€â”€ variables.tf
â”œâ”€â”€ variables/
â”‚   â”œâ”€â”€ global.tfvars
â”‚   â””â”€â”€ prod.tfvars
â””â”€â”€ docs/
    â””â”€â”€ ARCHITECTURE.md
```

## å‘½åè§„èŒƒ

### æ ‡å‡†å‘½åæ ¼å¼
- **æ ¼å¼**: `{env}-{component}-{resource-type}`
- **ç¤ºä¾‹**: `prod-cloud-native-istio-deployment`, `stage-cloud-native-neuvector-service`

### å®‰å…¨æ ‡ç­¾æ ‡å‡†
æ‰€æœ‰èµ„æºå¿…é¡»åŒ…å«ä»¥ä¸‹æ ‡ç­¾ï¼š
```hcl
{
  Environment  = "prod"
  CostCenter   = "12345"
  Security     = "cloud-native"
  ManagedBy    = "terraform"
  Project      = "cloud-native-infrastructure"
}
```

## å¿«é€Ÿå¼€å§‹

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
cd environments/prod

# åˆå§‹åŒ–
terraform init

# è§„åˆ’
terraform plan -out=tfplan

# åº”ç”¨
terraform apply tfplan
```

### Stageç¯å¢ƒéƒ¨ç½²

```bash
cd environments/stage

terraform init
terraform apply
```

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
cd environments/dev

terraform init
terraform apply
```

## æ¨¡å—ä¼˜å…ˆçº§ä¸ä¼ä¸šä½¿ç”¨ç‡è¯´æ˜

### ä¼˜å…ˆçº§å®šä¹‰
- ğŸ”´ **P0 - ä¼ä¸šå¿…éœ€**: ä½¿ç”¨ç‡ >80%ï¼Œç”Ÿäº§ç¯å¢ƒå¿…å¤‡ç»„ä»¶
- ğŸŸ¡ **P1 - é«˜ä¼˜å…ˆçº§**: ä½¿ç”¨ç‡ 50-80%ï¼Œä¼ä¸šæ¨èéƒ¨ç½²
- ğŸŸ¢ **P2 - ä¸­ä¼˜å…ˆçº§**: ä½¿ç”¨ç‡ 30-50%ï¼Œæ ¹æ®åœºæ™¯é€‰æ‹©
- ğŸ”µ **P3 - ç‰¹å®šåœºæ™¯**: ä½¿ç”¨ç‡ <30%ï¼Œç‰¹å®šéœ€æ±‚ä½¿ç”¨

---

## æ¨¡å—è¯´æ˜

### DevOpsæ¨¡å—
- ğŸ”´ **Helm** `[P0] [82%]`: åŒ…ç®¡ç†æ ‡å‡†
- ğŸ”´ **ArgoCD** `[P0] [80%]`: GitOpsæŒç»­äº¤ä»˜
- ğŸŸ¡ **GitLab** `[P1] [65%]`: ä¸€ä½“åŒ–DevOpså¹³å°
- ğŸŸ¡ **Flux** `[P1] [58%]`: GitOpså·¥å…·
- ğŸŸ¡ **Tekton** `[P1] [55%]`: äº‘åŸç”ŸCI/CD
- ğŸŸ¡ **Kustomize** `[P1] [55%]`: é…ç½®ç®¡ç†
- ğŸŸ¡ **Spinnaker** `[P1] [50%]`: å¤šç¯å¢ƒéƒ¨ç½²
- ğŸ”´ **Harbor** `[P0] [75%]`: å®¹å™¨é•œåƒä»“åº“
- ğŸŸ¢ **Jenkins X** `[P2] [35%]`: äº‘åŸç”ŸCI/CDå¹³å°

### Service Meshæ¨¡å—
- ğŸŸ¡ **Istio** `[P1] [45%]`: æœåŠ¡ç½‘æ ¼
- ğŸŸ¢ **Linkerd** `[P2] [25%]`: è½»é‡çº§æœåŠ¡ç½‘æ ¼
- ğŸŸ¢ **Traefik** `[P2] [42%]`: ç°ä»£HTTPåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨

### Networkingæ¨¡å—
- ğŸ”´ **Nginx Ingress** `[P0] [88%]`: å…¥å£æ§åˆ¶å™¨æ ‡å‡†
- ğŸŸ¡ **Calico** `[P1] [55%]`: ç½‘ç»œç­–ç•¥å’Œç½‘ç»œæ’ä»¶
- ğŸŸ¡ **Cilium** `[P1] [52%]`: åŸºäºeBPFçš„ç½‘ç»œã€é«˜æ€§èƒ½ã€å¯è§‚æµ‹æ€§
- ğŸ”´ **CoreDNS** `[P0] [90%]`: é›†ç¾¤DNSæœåŠ¡
- ğŸŸ¢ **MetalLB** `[P2] [40%]`: è´Ÿè½½å‡è¡¡å™¨
- ğŸŸ¢ **Traefik** `[P2] [42%]`: ç°ä»£HTTPåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨

### Storageæ¨¡å—
- ğŸŸ¢ **Longhorn** `[P2] [40%]`: è½»é‡çº§ã€å¯é ä¸”æ˜“äºä½¿ç”¨çš„åˆ†å¸ƒå¼å—å­˜å‚¨
- ğŸŸ¢ **MinIO** `[P2] [38%]`: å¯¹è±¡å­˜å‚¨
- ğŸŸ¢ **Rook-Ceph** `[P2] [38%]`: åˆ†å¸ƒå¼å­˜å‚¨
- ğŸŸ¢ **Local Storage** `[P2] [35%]`: æœ¬åœ°è·¯å¾„å­˜å‚¨

### Monitoringæ¨¡å—
- ğŸ”´ **Prometheus** `[P0] [85%]`: äº‘åŸç”Ÿç›‘æ§æ ‡å‡†
- ğŸ”´ **Metrics Server** `[P0] [85%]`: Kubernetes HPAå¿…éœ€
- ğŸ”´ **Grafana** `[P0] [92%]`: å¯è§†åŒ–ç›‘æ§ä»ªè¡¨ç›˜

### Observabilityæ¨¡å—
- ğŸ”´ **Loki** `[P0] [78%]`: æ—¥å¿—èšåˆæŸ¥è¯¢
- ğŸŸ¢ **Jaeger** `[P2] [45%]`: åˆ†å¸ƒå¼è¿½è¸ª
- ğŸŸ¢ **Fluentd** `[P2] [42%]`: æ—¥å¿—æ”¶é›†

### Securityæ¨¡å—
- ğŸŸ¢ **Trivy** `[P2] [48%]`: å®¹å™¨å®‰å…¨æ‰«æ
- ğŸŸ¢ **Falco** `[P2] [38%]`: è¿è¡Œæ—¶å®‰å…¨ç›‘æ§
- ğŸŸ¢ **Kyverno** `[P2] [40%]`: KubernetesåŸç”Ÿç­–ç•¥ç®¡ç†
- ğŸ”µ **Aqua Security** `[P3] [28%]`: å®¹å™¨å®‰å…¨å¹³å°
- ğŸ”µ **Gatekeeper** `[P3] [25%]`: OPAç­–ç•¥æ‰§è¡Œ
- ğŸ”µ **Kube-bench** `[P3] [22%]`: CISåŸºå‡†æµ‹è¯•
- ğŸ”µ **Kube-hunter** `[P3] [20%]`: æ¼æ´æ‰«æ
- ğŸ”µ **NeuVector** `[P3] [18%]`: å®¹å™¨å®‰å…¨å¹³å°
- ğŸ”µ **OPA** `[P3] [22%]`: ç­–ç•¥å³ä»£ç 
- ğŸ”µ **Wazuh** `[P3] [15%]`: å®‰å…¨ç›‘æ§

### Machine Learningæ¨¡å—
- ğŸŸ¢ **Kubeflow** `[P2] [35%]`: æœºå™¨å­¦ä¹ å¹³å°
- ğŸŸ¢ **MLflow** `[P2] [32%]`: å®éªŒè·Ÿè¸ª

### Cluster Managementæ¨¡å—
- ğŸ”µ **Rancher** `[P3] [28%]`: ä¼ä¸šçº§Kubernetesç®¡ç†å¹³å°
- ğŸ”µ **KubeOperator** `[P3] [25%]`: é›†ç¾¤è¿ç»´ç®¡ç†å¹³å°

### Platformæ¨¡å—
- ğŸ”µ **OAM** `[P3] [20%]`: å¼€æ”¾åº”ç”¨æ¨¡å‹å®ç°ï¼ˆä½¿ç”¨Crossplaneï¼‰
- ğŸ”µ **Portainer** `[P3] [18%]`: å®¹å™¨ç®¡ç†ç•Œé¢

### IAMæ¨¡å—ï¼ˆèº«ä»½è®¤è¯ä¸è®¿é—®æ§åˆ¶ï¼‰
- ğŸŸ¡ **Keycloak** `[P1] [65%]`: ç»Ÿä¸€èº«ä»½å’Œè®¿é—®ç®¡ç†ã€SSOã€OAuth2/OIDC
- ğŸŸ¢ **Dex** `[P2] [30%]`: OpenID Connectèº«ä»½æä¾›è€…

### Certificateæ¨¡å—ï¼ˆè¯ä¹¦ç®¡ç†ï¼‰
- ğŸ”´ **Cert-Manager** `[P0] [82%]`: TLSè¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†ã€Let's Encrypté›†æˆ

### Backupæ¨¡å—ï¼ˆå¤‡ä»½ä¸æ¢å¤ï¼‰
- ğŸŸ¡ **Velero** `[P1] [55%]`: Kuberneteså¤‡ä»½å’Œæ¢å¤
- ğŸŸ¢ **Kasten K10** `[P2] [42%]`: ä¼ä¸šçº§K8så¤‡ä»½

### Messagingæ¨¡å—ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ä¸äº‹ä»¶é©±åŠ¨ï¼‰
- ğŸŸ¡ **Kafka** `[P1] [70%]`: Apache Kafkaåˆ†å¸ƒå¼æµå¤„ç†å¹³å°
- ğŸŸ¡ **RabbitMQ** `[P1] [62%]`: ä¼ä¸šçº§æ¶ˆæ¯ä»£ç†

### Databaseæ¨¡å—ï¼ˆæ•°æ®åº“ä¸æ•°æ®ç®¡ç†ï¼‰
- ğŸ”´ **PostgreSQL** `[P0] [92%]`: æœ€å¹¿æ³›ä½¿ç”¨çš„å¼€æºå…³ç³»å‹æ•°æ®åº“
- ğŸ”´ **MySQL** `[P0] [90%]`: ä¼ä¸šçº§å…³ç³»å‹æ•°æ®åº“é¦–é€‰
- ğŸŸ¡ **MongoDB** `[P1] [58%]`: NoSQLæ–‡æ¡£æ•°æ®åº“

### Cacheæ¨¡å—ï¼ˆç¼“å­˜ä¸ä¼šè¯ç®¡ç†ï¼‰
- ğŸ”´ **Redis** `[P0] [88%]`: é«˜æ€§èƒ½ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- ğŸŸ¢ **Memcached** `[P2] [38%]`: åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿ

### API Gatewayæ¨¡å—ï¼ˆAPIç½‘å…³ï¼‰
- ğŸŸ¡ **Kong** `[P1] [60%]`: ä¼ä¸šçº§APIç½‘å…³
- ğŸŸ¢ **APISIX** `[P2] [45%]`: é«˜æ€§èƒ½APIç½‘å…³

### Searchæ¨¡å—ï¼ˆæœç´¢å¼•æ“ï¼‰
- ğŸŸ¡ **Elasticsearch** `[P1] [68%]`: åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æ

### Cost Managementæ¨¡å—ï¼ˆæˆæœ¬ç®¡ç†ï¼‰
- ğŸŸ¢ **Kubecost** `[P2] [48%]`: äº‘æˆæœ¬ç›‘æ§
- ğŸŸ¢ **OpenCost** `[P2] [38%]`: å¼€æºäº‘æˆæœ¬ç›‘æ§

### Developer Experienceæ¨¡å—ï¼ˆå¼€å‘è€…ä½“éªŒï¼‰
- ğŸŸ¢ **DevSpace** `[P2] [40%]`: äº‘åŸç”Ÿå¼€å‘å·¥å…·
- ğŸŸ¢ **Tilt** `[P2] [35%]`: æœ¬åœ°å¼€å‘ç¯å¢ƒå·¥å…·

---

## æ¨¡å—ç»Ÿè®¡æ±‡æ€»

| ä¼˜å…ˆçº§ | æ•°é‡ | å æ¯” | è¯´æ˜ |
|--------|------|------|------|
| ğŸ”´ P0 ä¼ä¸šå¿…éœ€ | 13 | 31% | ä½¿ç”¨ç‡ >80% |
| ğŸŸ¡ P1 é«˜ä¼˜å…ˆçº§ | 17 | 41% | ä½¿ç”¨ç‡ 50-80% |
| ğŸŸ¢ P2 ä¸­ä¼˜å…ˆçº§ | 12 | 29% | ä½¿ç”¨ç‡ 30-50% |
| ğŸ”µ P3 ç‰¹å®šåœºæ™¯ | 6 | 14% | ä½¿ç”¨ç‡ <30% |

**æ€»è®¡**: 48ä¸ªæ¨¡å— | **åˆ†ç±»è¦†ç›–ç‡**: 100% (20ä¸ªåˆ†ç±») | **TOP3è¦†ç›–ç‡**: 100%

## å®‰å…¨é…ç½®

### é¿å…çš„å®‰å…¨ç»„è§„åˆ™
- âŒ `0.0.0.0/0` å®‰å…¨ç»„è§„åˆ™
- âœ… ä½¿ç”¨æ˜ç¡®çš„CIDRèŒƒå›´
- âœ… ä½¿ç”¨å‘½åç«¯å£å’Œåè®®

### å˜é‡ç®¡ç†
æ‰€æœ‰æ•æ„Ÿä¿¡æ¯é€šè¿‡å˜é‡ä¼ é€’ï¼š
- å¯†ç ã€å¯†é’¥ã€è¯ä¹¦ç­‰
- ä½¿ç”¨ `sensitive = true` æ ‡è®°
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 

## ç¯å¢ƒå·®å¼‚

| ç»„ä»¶ | Prod | Stage | Dev |
|------|------|-------|-----|
| Istio mTLS | âœ… | âœ… | âŒ |
| Rook-Ceph | âœ… 3 OSD | âœ… 2 OSD | âŒ |
| NeuVector DLP | âœ… | âŒ | âŒ |
| å‰¯æœ¬æ•° | 3 | 2 | 1 |

## ç»´æŠ¤è¯´æ˜

### æ›´æ–°ç»„ä»¶ç‰ˆæœ¬
ç¼–è¾‘å¯¹åº”ç¯å¢ƒçš„ `terraform.tfvars` æ–‡ä»¶

### æ·»åŠ æ–°æ¨¡å—
1. åœ¨ `modules/` åˆ›å»ºæ–°æ¨¡å—
2. åœ¨ç¯å¢ƒ `main.tf` ä¸­å¼•ç”¨
3. æ›´æ–° `variables.tf` å’Œ `outputs.tf`

## è¾“å‡ºä¿¡æ¯

éƒ¨ç½²å®Œæˆåï¼ŒTerraformä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š
- æœåŠ¡URL
- å‘½åç©ºé—´
- å‡­è¯ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰
- ç«¯ç‚¹åœ°å€

## æ•…éšœæ’é™¤

### èµ„æºåˆ›å»ºå¤±è´¥
```bash
terraform plan -detailed-exitcode
terraform taint <resource>
terraform apply
```

### çŠ¶æ€æ–‡ä»¶æŸå
```bash
terraform refresh
terraform plan
```
